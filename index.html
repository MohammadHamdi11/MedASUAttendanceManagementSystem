<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Code Scanner</title>
<!-- PWA Meta Tags -->
<meta name="theme-color" content="#4CAF50">
<meta name="description" content="A QR code scanner application">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="QR Scanner">
<!-- iOS icon links -->
<link rel="apple-touch-icon" href="icons/icon-152x152.png">
<!-- Manifest file link -->
<link rel="manifest" href="manifest.json">
<style>
:root {
--primary-color: #4CAF50;
--secondary-color: #45a049;
--text-color: #333;
--bg-color: #f9f9f9;
--card-bg: #ffffff;
--border-color: #ddd;
}
* {
box-sizing: border-box;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
body {
margin: 0;
padding: 0;
background-color: var(--bg-color);
color: var(--text-color);
}
header {
background-color: var(--primary-color);
color: white;
text-align: center;
padding: 1rem;
position: sticky;
top: 0;
z-index: 100;
}
.container {
max-width: 1200px;
margin: 0 auto;
padding: 1rem;
}
.card {
background-color: var(--card-bg);
border-radius: 8px;
box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
padding: 1rem;
margin-bottom: 1rem;
}
.button {
background-color: var(--primary-color);
color: white;
border: none;
border-radius: 4px;
padding: 0.75rem 1rem;
cursor: pointer;
font-size: 1rem;
transition: background-color 0.3s;
}
.button:hover {
background-color: var(--secondary-color);
}
.button:disabled {
background-color: #cccccc;
cursor: not-allowed;
}
.button-secondary {
background-color: #f1f1f1;
color: var(--text-color);
border: 1px solid var(--border-color);
}
.button-secondary:hover {
background-color: #e1e1e1;
}
.tabs {
display: flex;
border-bottom: 1px solid var(--border-color);
margin-bottom: 1rem;
}
.tab {
padding: 0.75rem 1.5rem;
cursor: pointer;
border-bottom: 3px solid transparent;
}
.tab.active {
border-bottom: 3px solid var(--primary-color);
font-weight: bold;
}
.tab-content {
display: none;
}
.tab-content.active {
display: block;
}
#video {
width: 100%;
background-color: #000;
border-radius: 8px;
}
.scanner-container {
position: relative;
min-height: 300px;
}
.result-table {
width: 100%;
border-collapse: collapse;
margin-top: 1rem;
}
.result-table th, .result-table td {
border: 1px solid var(--border-color);
padding: 0.5rem;
text-align: left;
}
.result-table th {
background-color: #f1f1f1;
}
.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.5);
z-index: 1000;
}
.modal-content {
background-color: var(--card-bg);
margin: 15% auto;
padding: 20px;
border-radius: 8px;
width: 80%;
max-width: 500px;
}
.close {
float: right;
cursor: pointer;
font-size: 1.5rem;
}
input[type="text"] {
width: 100%;
padding: 0.75rem;
margin: 0.5rem 0;
border: 1px solid var(--border-color);
border-radius: 4px;
}
.history-item {
cursor: pointer;
}
.history-item:hover {
background-color: #f5f5f5;
}
.session-details {
margin-top: 1rem;
}
.flex-between {
display: flex;
justify-content: space-between;
align-items: center;
flex-wrap: wrap;
}
.no-results {
text-align: center;
padding: 2rem;
color: #666;
}
.filter-controls {
margin-bottom: 1rem;
}
select {
padding: 0.5rem;
border: 1px solid var(--border-color);
border-radius: 4px;
}
@media (max-width: 768px) {
.button {
width: 100%;
margin-bottom: 0.5rem;
}
.flex-between {
flex-direction: column;
align-items: stretch;
}
.modal-content {
width: 95%;
margin: 10% auto;
}
}
</style>
</head>
<body>
<header>
<h1>QR Code Scanner</h1>
</header>
<div class="container">
<div class="tabs">
<div class="tab active" data-tab="scanner">Scanner</div>
<div class="tab" data-tab="history">History</div>
</div>
<div id="scanner" class="tab-content active">
<div class="card">
<h2>QR Code Scanner</h2>
<div class="flex-between">
<button id="startSessionBtn" class="button">Start Scanning Session</button>
<div id="sessionInfo" style="display: none;">
<p><strong>Location:</strong> <span id="currentLocation">-</span></p>
<p><strong>Started:</strong> <span id="currentDateTime">-</span></p>
</div>
</div>
<div class="scanner-container">
<div id="scanner-placeholder" style="text-align: center; padding: 2rem;">
<p>Click "Start Scanning Session" to begin scanning QR codes.</p>
</div>
<video id="video" style="display: none;"></video>
</div>
<div class="scan-results">
<h3>Scanned QR Codes</h3>
<p id="noScansMessage">No QR codes scanned yet.</p>
<table id="resultTable" class="result-table" style="display: none;">
<thead>
<tr>
<th>ID</th>
<th>Content</th>
<th>Time</th>
</tr>
</thead>
<tbody id="resultBody"></tbody>
</table>
</div>
</div>
</div>
<div id="history" class="tab-content">
<div class="card">
<h2>Scanning History</h2>
<div class="flex-between">
<div>
<button id="exportAllBtn" class="button">Export All History</button>
</div>
<div class="filter-controls">
<select id="sortBy">
<option value="date-desc">Date (Newest First)</option>
<option value="date-asc">Date (Oldest First)</option>
<option value="location">Location</option>
</select>
</div>
</div>
<div id="historyList">
<p class="no-results">No scanning sessions found.</p>
</div>
<div id="sessionDetails" class="session-details" style="display: none;">
<h3>Session Details</h3>
<div class="flex-between">
<div>
<p><strong>Location:</strong> <span id="detailLocation">-</span></p>
<p><strong>Date & Time:</strong> <span id="detailDateTime">-</span></p>
<p><strong>Scans:</strong> <span id="detailCount">-</span></p>
</div>
<div>
<button id="exportSessionBtn" class="button">Export Session</button>
<button id="closeDetailsBtn" class="button button-secondary">Close Details</button>
</div>
</div>
<table class="result-table">
<thead>
<tr>
<th>ID</th>
<th>Content</th>
<th>Time</th>
</tr>
</thead>
<tbody id="detailsBody"></tbody>
</table>
</div>
</div>
</div>
</div>
<!-- Modal for Starting Session -->
<div id="sessionModal" class="modal">
<div class="modal-content">
<span class="close">&times;</span>
<h2>Start New Scanning Session</h2>
<p>Enter a location for this scanning session:</p>
<input type="text" id="locationInput" placeholder="e.g., Warehouse A, Office Room 102">
<p>This will help you identify and organize your scans.</p>
<button id="confirmSessionBtn" class="button">Start Now</button>
</div>
</div>
<!-- Script for QR Code Scanning -->
<script src="jsQR.min.js"></script>
<!-- Script for Excel Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
// DOM Elements
const tabs = document.querySelectorAll('.tab');
const tabContents = document.querySelectorAll('.tab-content');
const startSessionBtn = document.getElementById('startSessionBtn');
const sessionModal = document.getElementById('sessionModal');
const closeModalBtn = document.querySelector('.close');
const confirmSessionBtn = document.getElementById('confirmSessionBtn');
const locationInput = document.getElementById('locationInput');
const currentLocation = document.getElementById('currentLocation');
const currentDateTime = document.getElementById('currentDateTime');
const sessionInfo = document.getElementById('sessionInfo');
const video = document.getElementById('video');
const scannerPlaceholder = document.getElementById('scanner-placeholder');
const resultTable = document.getElementById('resultTable');
const resultBody = document.getElementById('resultBody');
const noScansMessage = document.getElementById('noScansMessage');
const exportAllBtn = document.getElementById('exportAllBtn');
const historyList = document.getElementById('historyList');
const sessionDetails = document.getElementById('sessionDetails');
const detailLocation = document.getElementById('detailLocation');
const detailDateTime = document.getElementById('detailDateTime');
const detailCount = document.getElementById('detailCount');
const detailsBody = document.getElementById('detailsBody');
const exportSessionBtn = document.getElementById('exportSessionBtn');
const closeDetailsBtn = document.getElementById('closeDetailsBtn');
const sortBy = document.getElementById('sortBy');
// Application State
let activeSession = null;
let canvasElement = document.createElement('canvas');
let canvas = canvasElement.getContext('2d');
let scanning = false;
let videoStream = null;
let sessions = [];
let activeSessionId = null;
let lastScannedCodes = new Set(); // For avoiding duplicate scans in quick succession
// Initialize Application
loadSessionsFromStorage();
updateHistoryView();
// Register Service Worker for PWA functionality
if ('serviceWorker' in navigator) {
window.addEventListener('load', () => {
navigator.serviceWorker.register('sw.js').catch(err => {
console.log('Service Worker registration failed: ', err);
});
});
}
// Tab Navigation
tabs.forEach(tab => {
tab.addEventListener('click', () => {
const tabId = tab.getAttribute('data-tab');
tabs.forEach(t => t.classList.remove('active'));
tabContents.forEach(tc => tc.classList.remove('active'));
tab.classList.add('active');
document.getElementById(tabId).classList.add('active');
});
});
// Start Session Button
startSessionBtn.addEventListener('click', () => {
sessionModal.style.display = 'block';
locationInput.focus();
});
// Close Modal
closeModalBtn.addEventListener('click', () => {
sessionModal.style.display = 'none';
});
// Register Service Worker for PWA functionality
if ('serviceWorker' in navigator) {
window.addEventListener('load', () => {
navigator.serviceWorker.register('sw.js')
.then(registration => {
console.log('ServiceWorker registration successful with scope: ', registration.scope);
})
.catch(err => {
console.log('ServiceWorker registration failed: ', err);
});
});
}
// Start new scanning session
confirmSessionBtn.addEventListener('click', async () => {
const location = locationInput.value.trim();
if (!location) {
alert('Please enter a location');
return;
}
// Hide modal
sessionModal.style.display = 'none';
// Create new session
const now = new Date();
const sessionId = `session_${now.getTime()}`;
const formattedDateTime = formatDateTime(now);
activeSession = {
id: sessionId,
location: location,
dateTime: now.toISOString(),
formattedDateTime: formattedDateTime,
scans: []
};
// Update UI
currentLocation.textContent = location;
currentDateTime.textContent = formattedDateTime;
sessionInfo.style.display = 'block';
// Start camera with verification
await startSessionWithVerification();
// Clear previous results
resultBody.innerHTML = '';
resultTable.style.display = 'none';
noScansMessage.style.display = 'block';
// Update button
startSessionBtn.textContent = 'End Session';
startSessionBtn.removeEventListener('click', startSessionBtnHandler);
startSessionBtn.addEventListener('click', endSessionHandler);
});
// First, let's modify how we set up the canvas and video elements
function setupScannerElements() {
// Make the canvas visible for debugging
canvasElement.style.display = 'block';
canvasElement.style.position = 'absolute';
canvasElement.style.top = '10px';
canvasElement.style.right = '10px';
canvasElement.style.width = '100px';
canvasElement.style.height = '100px';
canvasElement.style.border = '2px solid red';
canvasElement.style.zIndex = '999';
document.querySelector('.scanner-container').appendChild(canvasElement);
// Add scanning indicator
const scanIndicator = document.createElement('div');
scanIndicator.id = 'scan-indicator';
scanIndicator.style.position = 'absolute';
scanIndicator.style.top = '50%';
scanIndicator.style.left = '50%';
scanIndicator.style.transform = 'translate(-50%, -50%)';
scanIndicator.style.width = '200px';
scanIndicator.style.height = '200px';
scanIndicator.style.border = '2px solid #4CAF50';
scanIndicator.style.borderRadius = '10px';
scanIndicator.style.boxShadow = '0 0 0 2000px rgba(0, 0, 0, 0.3)';
scanIndicator.style.zIndex = '998';
document.querySelector('.scanner-container').appendChild(scanIndicator);
// Add status text
const statusText = document.createElement('div');
statusText.id = 'scan-status';
statusText.style.position = 'absolute';
statusText.style.bottom = '10px';
statusText.style.left = '50%';
statusText.style.transform = 'translateX(-50%)';
statusText.style.backgroundColor = 'rgba(0,0,0,0.7)';
statusText.style.color = 'white';
statusText.style.padding = '8px 16px';
statusText.style.borderRadius = '20px';
statusText.style.zIndex = '999';
statusText.textContent = 'Position QR code in the center';
document.querySelector('.scanner-container').appendChild(statusText);
}
// Test if the canvas is working properly
function testCanvasOperation() {
// Make canvas visible for debug
canvasElement.style.display = 'block';
canvasElement.style.position = 'absolute';
canvasElement.style.top = '10px';
canvasElement.style.left = '10px';
canvasElement.style.width = '200px';
canvasElement.style.height = '200px';
canvasElement.style.border = '2px solid blue';
canvasElement.style.zIndex = '9999';
document.body.appendChild(canvasElement);
// Set canvas size
canvasElement.width = 200;
canvasElement.height = 200;
// Draw something to test
canvas.fillStyle = 'green';
canvas.fillRect(0, 0, 100, 100);
canvas.fillStyle = 'red';
canvas.fillRect(100, 100, 100, 100);
canvas.fillStyle = 'white';
canvas.font = '20px Arial';
canvas.fillText('Canvas OK', 50, 50);
// Try to get image data
try {
const testData = canvas.getImageData(0, 0, 200, 200);
console.log("Canvas imageData test:", testData.data.length > 0 ? "OK" : "Failed");
return testData.data.length > 0;
} catch (e) {
console.error("Canvas getImageData failed:", e);
alert("Canvas operation failed: " + e.message + 
"\nThis could indicate issues with your browser security settings or cross-origin restrictions.");
return false;
}
}
// Call this before starting the QR scanner
function verifyEnvironment() {
// Check for canvas support
if (!canvasElement || !canvas) {
alert("Your browser does not support canvas operations required for QR scanning.");
return false;
}
// Test canvas operations
if (!testCanvasOperation()) {
return false;
}
// Check for video support
if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
alert("Your browser does not support camera access required for QR scanning.");
return false;
}
// Check for jsQR
if (typeof jsQR !== 'function') {
alert("QR scanning library is not loaded.");
return false;
}
return true;
}
function loadJsQRLibrary() {
  return new Promise((resolve, reject) => {
    // First try loading from CDN
    const script = document.createElement('script');
    script.src = "https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js";
    script.onload = () => {
      console.log("jsQR loaded successfully from CDN");
      resolve('cdn');
    };
    script.onerror = () => {
      console.warn("Failed to load jsQR from CDN, trying local fallback...");
      
      // If CDN fails, try loading local copy
      const localScript = document.createElement('script');
      localScript.src = "jsQR.min.js"; // Assuming you've downloaded it
      localScript.onload = () => {
        console.log("jsQR loaded successfully from local file");
        resolve('local');
      };
      localScript.onerror = () => {
        console.error("Failed to load jsQR from both CDN and local file");
        reject(new Error("Could not load jsQR library"));
      };
      document.head.appendChild(localScript);
    };
    document.head.appendChild(script);
  });
}
// Add this check before starting your scanner
startSessionBtn.addEventListener('click', () => {
if (verifyEnvironment()) {
sessionModal.style.display = 'block';
locationInput.focus();
} else {
alert("Your device or browser does not meet the requirements for QR code scanning.");
}
});
// Enhanced start scanner function
async function startScanner() {
try {
// Set up visual elements
setupScannerElements();
// Get user media with lower resolution first (might be more stable)
const constraints = {
video: { 
facingMode: "environment",
width: { ideal: 640 },  // Lower resolution may work better
height: { ideal: 480 }
}
};
videoStream = await navigator.mediaDevices.getUserMedia(constraints);
video.srcObject = videoStream;
video.setAttribute("playsinline", true);
// Important: Wait for metadata before getting dimensions
video.onloadedmetadata = () => {
console.log(`Video dimensions: ${video.videoWidth}x${video.videoHeight}`);
video.play();
scanning = true;
scannerPlaceholder.style.display = 'none';
video.style.display = 'block';
  // Add debug overlay
  setupDebugOverlay();
// Start the scanning process
requestAnimationFrame(tick);
// Set status text
document.getElementById('scan-status').textContent = 'Camera active - looking for QR codes';
};
} catch (error) {
console.error("Failed to access camera:", error);
alert("Failed to access camera. Please ensure camera permissions are enabled.");
}
}
function setupDebugOverlay() {
  const debugOverlay = document.createElement('div');
  debugOverlay.id = 'qr-debug-overlay';
  debugOverlay.style.position = 'absolute';
  debugOverlay.style.top = '10px';
  debugOverlay.style.left = '10px';
  debugOverlay.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
  debugOverlay.style.color = 'white';
  debugOverlay.style.padding = '10px';
  debugOverlay.style.borderRadius = '5px';
  debugOverlay.style.zIndex = '1000';
  debugOverlay.style.fontSize = '12px';
  debugOverlay.style.maxWidth = '300px';
  document.querySelector('.scanner-container').appendChild(debugOverlay);
  
  // Update debug info every second
  let frameCount = 0;
  let lastFrameCount = 0;
  let lastUpdateTime = Date.now();
  
  // Monkey patch requestAnimationFrame to count frames
  const originalRAF = window.requestAnimationFrame;
  window.requestAnimationFrame = function(callback) {
    frameCount++;
    return originalRAF(callback);
  };
  
  setInterval(() => {
    const now = Date.now();
    const elapsed = (now - lastUpdateTime) / 1000;
    const fps = Math.round((frameCount - lastFrameCount) / elapsed);
    lastFrameCount = frameCount;
    lastUpdateTime = now;
    
    // Get camera details
    let cameraInfo = 'No camera';
    if (videoStream) {
      const videoTrack = videoStream.getVideoTracks()[0];
      if (videoTrack) {
        cameraInfo = `${videoTrack.label} (${videoTrack.enabled ? 'enabled' : 'disabled'})`;
        
        // Try to get advanced settings
        try {
          const settings = videoTrack.getSettings();
          if (settings) {
            cameraInfo += `<br>Resolution: ${settings.width}x${settings.height}`;
            if (settings.frameRate) {
              cameraInfo += `<br>Frame rate: ${settings.frameRate}`;
            }
          }
        } catch (e) {
          console.log("Could not get camera settings:", e);
        }
      }
    }
    
    // Check jsQR status
    const jsQRStatus = typeof jsQR === 'function' ? 'Available' : 'Not loaded';
    
    // Update the debug overlay
    debugOverlay.innerHTML = `
      <strong>QR Scanner Debug</strong><br>
      jsQR: ${jsQRStatus}<br>
      Camera: ${cameraInfo}<br>
      Video: ${video.videoWidth}x${video.videoHeight}<br>
      Canvas: ${canvasElement.width}x${canvasElement.height}<br>
      FPS: ${fps}<br>
      Scanning: ${scanning ? 'Active' : 'Inactive'}<br>
      <button id="toggle-debug" style="margin-top: 5px; padding: 3px; font-size: 10px;">Hide Debug</button>
    `;
    
    // Add toggle button functionality
    document.getElementById('toggle-debug').addEventListener('click', function() {
      if (debugOverlay.style.height === 'auto') {
        debugOverlay.style.height = '20px';
        debugOverlay.style.overflow = 'hidden';
        this.textContent = 'Show Debug';
      } else {
        debugOverlay.style.height = 'auto';
        debugOverlay.style.overflow = 'visible';
        this.textContent = 'Hide Debug';
      }
    });
  }, 1000);
}
// Completely rewritten tick function with more verbose debugging and error handling
function tick() {
  if (!scanning) return;
  
  // First check if video is ready
  if (video.readyState !== video.HAVE_ENOUGH_DATA) {
    requestAnimationFrame(tick);
    return;
  }
  
  const statusEl = document.getElementById('scan-status') || document.createElement('div');
  statusEl.textContent = 'Processing frame...';
  
  try {
    // Clear canvas first
    canvas.clearRect(0, 0, canvasElement.width, canvasElement.height);
    
    // Make sure dimensions match video
    canvasElement.height = video.videoHeight;
    canvasElement.width = video.videoWidth;
    
    // Draw the current video frame
    canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
    
    // Get image data - wrapped in try/catch
    let imageData;
    try {
      imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
    } catch (e) {
      console.error("Failed to get image data:", e);
      
      // If this is a security error, likely a CORS issue
      if (e.name === 'SecurityError') {
        alert("Security error accessing camera data. This may be due to CORS restrictions.");
        scanning = false;
        return;
      }
      
      requestAnimationFrame(tick);
      return;
    }
    
    // Verify we have valid data
    if (!imageData || imageData.width === 0 || imageData.height === 0) {
      console.error("Invalid image data");
      requestAnimationFrame(tick);
      return;
    }
    
    // Log dimensions periodically (every 30 frames)
    if (Math.random() < 0.033) { // ~1/30 probability
      console.log(`Processing frame: ${imageData.width}x${imageData.height}`);
    }
    
    // Try different QR code detection strategies
    let code = null;
    const options = [
      { inversionAttempts: "dontInvert" },
      { inversionAttempts: "onlyInvert" },
      { inversionAttempts: "attemptBoth" }
    ];
    
    // Try each option until we find a code
    for (const option of options) {
      if (typeof jsQR !== 'function') {
        console.error("jsQR function not available");
        statusEl.textContent = 'QR scanner not initialized';
        requestAnimationFrame(tick);
        return;
      }
      
      try {
        code = jsQR(imageData.data, imageData.width, imageData.height, option);
        if (code) break;
      } catch (e) {
        console.error("jsQR error with option", option, e);
      }
    }
    
    if (code) {
      console.log("QR Code detected:", code.data);
      statusEl.textContent = `Detected: ${code.data.substring(0, 20)}${code.data.length > 20 ? '...' : ''}`;
      
      // Draw the QR code location
      drawQrHighlight(code.location);
      
      // Process the scanned code (with duplicate prevention)
      if (!lastScannedCodes.has(code.data)) {
        lastScannedCodes.add(code.data);
        setTimeout(() => lastScannedCodes.delete(code.data), 3000);
        processScannedCode(code.data);
        
        // Provide haptic feedback if available
        if (navigator.vibrate) {
          navigator.vibrate(200);
        }
        
        // Play a success sound
        const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLX7N7tivZDAtXqDO47FxQE5WY3OAoswEIjJ1kpuM54UlJHG1yrGPWDc9i/Hjx3Q0FUyj4sKHQiRMmea6eyg8abXLmD8yPqLat18lM5PqyGgkHFjF6MxxKyFSt/LZmD0gNqf24rplGhxj2O2/VSEucMnriEAmJGvT8cJ+IiBVw/nioQkMHFHY/89yBwhT2P/YZQYBS3sHDw8predxNw00grC9iSwHVcL7r0gFBk6V+rt3CAE9f/LXpg8HJ2vrz6cYBxpR5OC+YTUphOTvni0HF03k8Kk5BAQwWOXwrw4DAiRZ8OimDgMTON7szQT9KWP4vQwEAjOa/cVqEQ8xk/1+GQolc94VRAQQPKL8gBgJChxL7CAMDxJEq/qOLg0MClj2BBgIBhhT9iAUDQEZRvx7Iw8TPXD1VhMKCU2Y/pMpCgsdTPFB8Pnh6P5XCyEkZ/o/7vft//IEBBtE9DIK/vwE/wgJGzb0qRD2/A/+AQT+CiRN9dkB+/krEP8RIlHmzvn+DSUdLUnYues0BSIXEz7aGu3d5PMGJThXp8aj0PL4AwoXOM8a2Mf1Cgw1S+kvzMP7vRBDWPIh1djjzv8TLGrsEsPH/O8JLFzkO+Ho5MITH1TxBsPF88IEN2/rIsKu8UwEPHXpIrWF7oAGQojjJaFz7P4EQ5DhGJ5n8BoDOIvgLZdz9zwDLIjgNZuA+u4CI4rgPZ2J/kwDGX3fQaaY/zsCA2/eSbCr/2IBBGfeWbq8/8cAAQnfacbPAMT//wDfa8vbAcn+/f/bc9HjAs/9+/7Wd9frA9T9+fzMet3yBd39+PvCfuH4B+j++vq4geb8CfT/+vm0g+j/C/wB+/ixhOsEEAMF+/atfe4KFAYK+/Wreuj9DNwZ3umsetuQN+TuxnJCX+0Dc7XtZBFtz/EAhLTpTxlw0PAAfLDmgiBy1vD7cqzihSR32fH3aKngiiZ63PP0V6feiCh/3vXyL6LciCV8y8r0TZvXfx9wv871QpXRehdnuPjxOo/Ncw9equX4MSuGxmwEU5nZ+DIjfcJbEWOTtKBRNn+0jCZvrYZhYmaVnVBCg66XZFRTlbhWRgAAwf8AAcX/AAHK/wEBzP8BAcz/AQHM/wEBzP8BAcz/AQHM/wEBzP8BAcz/AQHJ/wEBw/8AAAApJSFIqqOUnoiIiJgyPVJ2h5CmqaypqrB6eH9ORENHSEhFREJANzQ4LCgkHhgwOktVVlFMSUVAPjw5MywrNCMZGBdpSzctF0NkV0Q3M1tpV0AxN11xYEc0O2F4ZEs4PmF4YkY1Ol9uWj4wOViGfFgvOHGeol8xL3/InWowM4nWoV8tN5Tcol0rOZzlpVspP6bvqVtVaG5ubm5sbGlnZmRgYF5cWVdWVFJRT05LSUZFQ0JAP0A+PDk4NzU0MDEwMC4tLSwsLCoqKioppqWmpqalpqelpqWmpqenpqenp6enp6eoqKioqKioqKioqKioqKioqKmpqampqampqampqampqampqampqampqampqampqampqqqsra+ws7W3urq7vbzc3Nzc29vb2tra2dnZ2djY2NjX19fW1tbW1dXV1dXV1NTU1NTT09PT09PS0tLS0tLR0dHQ0NDQ0NDPz8/Pz8/Ozs7Ozs7Nzc3MzMzMzMzLy8vLy8vKysrKysrJycnIyMjIyMjHx8fHx8fGxsbGxsbFxcXExMTDw8PCwsLBwcHAwMC/v7+cmpoPDQ4NDAsLCwsKCgoKCQkJCQkICAgIBwcHBwcHBgYGBgYGBgUFBQUFBQQEBAQEBAMDAwMDAwICAgICAgEBAQEBAQAAAAAA');
        audio.play().catch(e => console.log("Audio play failed:", e));
      }
    } else {
      statusEl.textContent = 'Scanning for QR code...';
    }
  } catch (error) {
    console.error("Error in QR scanning process:", error);
    statusEl.textContent = 'Error in scan process';
  }
  
  // Continue scanning
  requestAnimationFrame(tick);
}
// Run QR detection with different options
let code = null;
// First try with default settings
code = jsQR(imageData.data, imageData.width, imageData.height, {
inversionAttempts: "dontInvert",
});
// If not found, try with inversion
if (!code) {
code = jsQR(imageData.data, imageData.width, imageData.height, {
inversionAttempts: "attemptBoth",
});
}
console.timeEnd('jsQR processing');
if (code) {
console.log("QR Code detected:", code.data);
statusEl.textContent = `Detected: ${code.data.substring(0, 20)}${code.data.length > 20 ? '...' : ''}`;
// Draw the QR code location
drawQrHighlight(code.location);
// Check if this code was recently scanned (to prevent duplicates)
if (!lastScannedCodes.has(code.data)) {
// Add to recent scans set and set timeout to remove
lastScannedCodes.add(code.data);
setTimeout(() => {
lastScannedCodes.delete(code.data);
}, 3000); // Prevent duplicate scans for 3 seconds
// Process the scanned code
processScannedCode(code.data);
}
} else {
statusEl.textContent = 'Scanning... (no QR code detected)';
}
} catch (error) {
console.error("Error in QR scanning process:", error);
statusEl.textContent = 'Error in scan process';
}
} else {
console.log("Video not ready yet");
}
// Continue scanning
requestAnimationFrame(tick);
}
// Helper function to draw QR highlight
function drawQrHighlight(location) {
// Draw QR code outline
canvas.beginPath();
canvas.moveTo(location.topLeftCorner.x, location.topLeftCorner.y);
canvas.lineTo(location.topRightCorner.x, location.topRightCorner.y);
canvas.lineTo(location.bottomRightCorner.x, location.bottomRightCorner.y);
canvas.lineTo(location.bottomLeftCorner.x, location.bottomLeftCorner.y);
canvas.lineTo(location.topLeftCorner.x, location.topLeftCorner.y);
canvas.lineWidth = 4;
canvas.strokeStyle = "#FF3B58";
canvas.stroke();
// Also highlight on the video view for user feedback
const indicator = document.getElementById('scan-indicator');
indicator.style.borderColor = '#FF3B58';
// Reset after a short time
setTimeout(() => {
indicator.style.borderColor = '#4CAF50';
}, 500);
}
// Add this function to verify jsQR library is loaded properly
function verifyJsQrLibrary() {
if (typeof jsQR === 'undefined') {
console.error("jsQR library is not loaded!");
alert("QR scanning library failed to load. Please check your internet connection and refresh the page.");
return false;
} else {
console.log("jsQR library found:", jsQR);
return true;
}
}
// Call this function when starting a session
function startSessionWithVerification() {
if (verifyJsQrLibrary()) {
startScanner();
}
}
function debugQrScanner() {
// Create debugging elements
const debugContainer = document.createElement('div');
debugContainer.style.position = 'absolute';
debugContainer.style.top = '10px';
debugContainer.style.left = '10px';
debugContainer.style.background = 'rgba(0,0,0,0.5)';
debugContainer.style.color = 'white';
debugContainer.style.padding = '10px';
debugContainer.style.borderRadius = '5px';
debugContainer.style.zIndex = '1000';
debugContainer.style.fontSize = '12px';
const debugText = document.createElement('pre');
debugContainer.appendChild(debugText);
document.querySelector('.scanner-container').appendChild(debugContainer);
// Add canvas to the page for visualizing what the QR scanner sees
canvasElement.style.display = 'block';
canvasElement.style.position = 'absolute';
canvasElement.style.top = '0';
canvasElement.style.left = '0';
canvasElement.style.width = '160px';
canvasElement.style.height = '120px';
canvasElement.style.border = '2px solid red';
canvasElement.style.zIndex = '999';
document.querySelector('.scanner-container').appendChild(canvasElement);
// Update debug info periodically
setInterval(() => {
if (video.videoWidth) {
debugText.textContent = `Video: ${video.videoWidth}x${video.videoHeight}\n` +
`Canvas: ${canvasElement.width}x${canvasElement.height}\n` +
`Scanning: ${scanning}`;
}
}, 1000);
}
// Process scanned QR code
function processScannedCode(data) {
const now = new Date();
const scan = {
id: activeSession.scans.length + 1,
content: data,
time: now.toISOString(),
formattedTime: formatTime(now)
};
activeSession.scans.push(scan);
// Update UI
if (activeSession.scans.length === 1) {
noScansMessage.style.display = 'none';
resultTable.style.display = 'table';
}
const row = document.createElement('tr');
row.innerHTML = `
<td>${scan.id}</td>
<td>${escapeHtml(scan.content)}</td>
<td>${scan.formattedTime}</td>
`;
resultBody.appendChild(row);
// Play a success sound (optional)
const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLX7N7tivZDAtXqDO47FxQE5WY3OAoswEIjJ1kpuM54UlJHG1yrGPWDc9i/Hjx3Q0FUyj4sKHQiRMmea6eyg8abXLmD8yPqLat18lM5PqyGgkHFjF6MxxKyFSt/LZmD0gNqf24rplGhxj2O2/VSEucMnriEAmJGvT8cJ+IiBVw/nioQkMHFHY/89yBwhT2P/YZQYBS3sHDw8predxNw00grC9iSwHVcL7r0gFBk6V+rt3CAE9f/LXpg8HJ2vrz6cYBxpR5OC+YTUphOTvni0HF03k8Kk5BAQwWOXwrw4DAiRZ8OimDgMTON7szQT9KWP4vQwEAjOa/cVqEQ8xk/1+GQolc94UKRAQPKL8gBgJChxL7CAMDxJEq/qOLg0MClj2BBgIBhhT9iAUDQEZRvx7Iw8TPXD1VhMKCU2Y/pMpCgsdTPFB8Pnh6P5XCyEkZ/o/7vft//IEBBtE9DIK/vwE/wgJGzb0qRD2/A/+AQT+CiRN9dkB+/krEP8RIlHmzvn+DSUdLUnYues0BSIXEz7aGu3d5PMGJThXp8aj0PL4AwoXOM8a2Mf1Cgw1S+kvzMP7vRBDWPIh1djjzv8TLGrsEsPH/O8JLFzkO+Ho5MITH1TxBsPF88IEN2/rIsKu8UwEPHXpIrWF7oAGQojjJaFz7P4EQ5DhGJ5n8BoDOIvgLZdz9zwDLIjgNZuA+u4CI4rgPZ2J/kwDGX3fQaaY/zsCA2/eSbCr/2IBBGfeWbq8/8cAAQnfacbPAMT//wDfa8vbAcn+/f/bc9HjAs/9+/7Wd9frA9T9+fzMet3yBd39+PvCfuH4B+j++vq4geb8CfT/+vm0g+j/C/wB+/ixhOsEEAMF+/atfe4KFAYK+/Wreuj9DNwZ3umsetuQN+TuxnJCX+0Dc7XtZBFtz/EAhLTpTxlw0PAAfLDmgiBy1vD7cqzihSR32fH3aKngiiZ63PP0V6feiCh/3vXyL6LciCV8y8r0TZvXfx9wv871QpXRehdnuPjxOo/Ncw9equX4MSuGxmwEU5nZ+DIjfcJbEWOTtKBRNn+0jCZvrYZhYmaVnVBCg66XZFRTlbhWRgAAwf8AAcX/AAHK/wEBzP8BAcz/AQHM/wEBzP8BAcz/AQHM/wEBzP8BAcz/AQHJ/wEBw/8AAAApJSFIqqOUnoiIiJgyPVJ2h5CmqaypqrB6eH9ORENHSEhFREJANzQ4LCgkHhgwOktVVlFMSUVAPjw5MywrNCMZGBdpSzctF0NkV0Q3M1tpV0AxN11xYEc0O2F4ZEs4PmF4YkY1Ol9uWj4wOViGfFgvOHGeol8xL3/InWowM4nWoV8tN5Tcol0rOZzlpVspP6bvqVtVaG5ubm5sbGlnZmRgYF5cWVdWVFJRT05LSUZFQ0JAP0A+PDk4NzU0MDEwMC4tLSwsLCoqKioppqWmpqalpqelpqWmpqenpqenp6enp6eoqKioqKioqKioqKioqKioqKmpqampqampqampqampqampqampqampqampqampqampqqqsra+ws7W3urq7vbzc3Nzc29vb2tra2dnZ2djY2NjX19fW1tbW1dXV1dXV1NTU1NTT09PT09PS0tLS0tLR0dHQ0NDQ0NDPz8/Pz8/Ozs7Ozs7Nzc3MzMzMzMzLy8vLy8vKysrKysrJycnIyMjIyMjHx8fHx8fGxsbGxsbFxcXExMTDw8PCwsLBwcHAwMC/v7+cmpoPDQ4NDAsLCwsKCgoKCQkJCQkICAgIBwcHBwcHBgYGBgYGBgUFBQUFBQQEBAQEBAMDAwMDAwICAgICAgEBAQEBAQAAAAAA');
audio.play().catch(e => console.log("Audio play failed:", e));
}
// End current scanning session
function endSessionHandler() {
if (scanning) {
scanning = false;
if (videoStream) {
videoStream.getTracks().forEach(track => track.stop());
videoStream = null;
}
video.style.display = 'none';
scannerPlaceholder.style.display = 'block';
// Save session to history
sessions.push(activeSession);
saveSessionsToStorage();
updateHistoryView();
// Auto-export this session
exportSession(activeSession);
// Reset UI
sessionInfo.style.display = 'none';
startSessionBtn.textContent = 'Start Scanning Session';
startSessionBtn.removeEventListener('click', endSessionHandler);
startSessionBtn.addEventListener('click', startSessionBtnHandler);
// Show confirmation
alert('Session completed and exported successfully!');
}
}
// Handler for start session button
function startSessionBtnHandler() {
sessionModal.style.display = 'block';
locationInput.focus();
}
// Export all history to Excel
exportAllBtn.addEventListener('click', () => {
if (sessions.length === 0) {
alert('No sessions to export');
return;
}
exportAllSessions();
});
// Sort history sessions
sortBy.addEventListener('change', updateHistoryView);
// Export single session
exportSessionBtn.addEventListener('click', () => {
if (!activeSessionId) return;
const session = sessions.find(s => s.id === activeSessionId);
if (session) {
exportSession(session);
}
});
// Close session details
closeDetailsBtn.addEventListener('click', () => {
sessionDetails.style.display = 'none';
});
// Save sessions to local storage
function saveSessionsToStorage() {
localStorage.setItem('qrScannerSessions', JSON.stringify(sessions));
}
// Load sessions from local storage
function loadSessionsFromStorage() {
const savedSessions = localStorage.getItem('qrScannerSessions');
if (savedSessions) {
sessions = JSON.parse(savedSessions);
}
}
// Update history view with sessions
function updateHistoryView() {
if (sessions.length === 0) {
historyList.innerHTML = '<p class="no-results">No scanning sessions found.</p>';
return;
}
// Sort sessions based on selected option
const sortValue = sortBy.value;
const sortedSessions = [...sessions].sort((a, b) => {
if (sortValue === 'date-desc') {
return new Date(b.dateTime) - new Date(a.dateTime);
} else if (sortValue === 'date-asc') {
return new Date(a.dateTime) - new Date(b.dateTime);
} else if (sortValue === 'location') {
return a.location.localeCompare(b.location);
}
return 0;
});
// Generate HTML
historyList.innerHTML = '';
sortedSessions.forEach(session => {
const card = document.createElement('div');
card.className = 'card history-item';
card.setAttribute('data-id', session.id);
card.innerHTML = `
<div class="flex-between">
<div>
<h3>${escapeHtml(session.location)}</h3>
<p>${session.formattedDateTime}</p>
</div>
<div>
<p><strong>${session.scans.length}</strong> scans</p>
</div>
</div>
`;
card.addEventListener('click', () => {
activeSessionId = session.id;
showSessionDetails(session);
});
historyList.appendChild(card);
});
}
// Show session details
function showSessionDetails(session) {
detailLocation.textContent = session.location;
detailDateTime.textContent = session.formattedDateTime;
detailCount.textContent = session.scans.length;
// Fill table
detailsBody.innerHTML = '';
session.scans.forEach(scan => {
const row = document.createElement('tr');
row.innerHTML = `
<td>${scan.id}</td>
<td>${escapeHtml(scan.content)}</td>
<td>${scan.formattedTime}</td>
`;
detailsBody.appendChild(row);
});
sessionDetails.style.display = 'block';
}
// Export single session to Excel
function exportSession(session) {
const fileName = `${session.location.replace(/[^a-z0-9]/gi, '_')}_${formatDateTimeForFile(new Date(session.dateTime))}.xlsx`;
// Prepare data
const data = [
['ID', 'Content', 'Location', 'Date', 'Time']
];
session.scans.forEach(scan => {
const scanDate = new Date(scan.time);
data.push([
scan.id,
scan.content,
session.location,
formatDate(scanDate),
formatTime(scanDate)
]);
});
// Create workbook
const ws = XLSX.utils.aoa_to_sheet(data);
const wb = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb, ws, "Scans");
// Save file
XLSX.writeFile(wb, fileName);
}
// Export all sessions to Excel
function exportAllSessions() {
if (sessions.length === 0) return;
const fileName = `QR_Scan_All_Sessions_${formatDateTimeForFile(new Date())}.xlsx`;
const wb = XLSX.utils.book_new();
// For each session
sessions.forEach(session => {
const data = [
['ID', 'Content', 'Location', 'Date', 'Time']
];
session.scans.forEach(scan => {
const scanDate = new Date(scan.time);
data.push([
scan.id,
scan.content,
session.location,
formatDate(scanDate),
formatTime(scanDate)
]);
});
if (data.length > 1) {
const ws = XLSX.utils.aoa_to_sheet(data);
const sheetName = session.location.substring(0, 30).replace(/[^a-z0-9]/gi, '_');
XLSX.utils.book_append_sheet(wb, ws, sheetName);
}
});
// Save file
XLSX.writeFile(wb, fileName);
}
// Helper function to format date for display
function formatDate(date) {
return `${date.getFullYear()}-${padZero(date.getMonth() + 1)}-${padZero(date.getDate())}`;
}
// Helper function to format time for display
function formatTime(date) {
return `${padZero(date.getHours())}:${padZero(date.getMinutes())}:${padZero(date.getSeconds())}`;
}
// Helper function to format date and time for display
function formatDateTime(date) {
return `${formatDate(date)} ${formatTime(date)}`;
}
// Helper function to format date and time for filenames
function formatDateTimeForFile(date) {
return `${date.getFullYear()}${padZero(date.getMonth() + 1)}${padZero(date.getDate())}_${padZero(date.getHours())}${padZero(date.getMinutes())}`;
}
// Helper function to pad with leading zero
function padZero(num) {
return num.toString().padStart(2, '0');
}
// Add this code to your page to check if jsQR is loading correctly
function testJsQrLibrary() {
console.log("Testing jsQR library...");
// Create a simple test QR code (this is a small 21x21 QR code for "test")
// This is a pre-generated QR code for the text "test"
const qrWidth = 21;
const qrHeight = 21;
const testData = new Uint8ClampedArray(qrWidth * qrHeight * 4);
// Fill with white first (255,255,255,255)
for (let i = 0; i < testData.length; i += 4) {
testData[i] = 255;     // R
testData[i + 1] = 255; // G
testData[i + 2] = 255; // B
testData[i + 3] = 255; // A
}
// Add this function right after your existing testJsQrLibrary function
function diagnoseJsQrIssue() {
  console.log("Diagnosing jsQR loading issues...");
  
  // Check if the script loaded at all
  const jsQrScript = document.querySelector('script[src*="jsQR"]');
  if (!jsQrScript) {
    console.error("jsQR script tag not found in document");
    return "Script tag missing";
  }
  
  // Check if the script loaded successfully
  if (jsQrScript.getAttribute('data-loaded') !== 'true') {
    console.error("jsQR script may not have loaded completely");
  }
  
  // Check if jsQR is defined
  if (typeof jsQR === 'undefined') {
    console.error("jsQR is undefined - library failed to load or initialize");
    return "Library not loaded";
  }
  
  // Check if jsQR is a function
  if (typeof jsQR !== 'function') {
    console.error("jsQR is not a function - incorrect library loaded");
    return "Library incorrect";
  }
  
  // Try a simple test
  try {
    // Create a tiny test image (1x1 white pixel)
    const testData = new Uint8ClampedArray([255, 255, 255, 255]);
    // Just testing if function executes without error
    jsQR(testData, 1, 1);
    console.log("jsQR function executed without error");
    return "Library OK";
  } catch (e) {
    console.error("jsQR function threw an error:", e);
    return "Library error: " + e.message;
  }
}

// Modify your window load event handler
window.addEventListener('load', () => {
  // Wait for everything to load
  setTimeout(() => {
    // Mark the script as loaded (add this attribute to track load status)
    const jsQrScript = document.querySelector('script[src*="jsQR"]');
    if (jsQrScript) {
      jsQrScript.setAttribute('data-loaded', 'true');
    }
    
    // Run diagnostics
    const status = diagnoseJsQrIssue();
    console.log("jsQR Diagnosis:", status);
    
    if (status !== "Library OK") {
      alert("QR scanner issue detected: " + status + 
            "\nTry using a local copy of the library or check console for details.");
    } else {
      testJsQrLibrary();
    }
  }, 2000);
});
// Try to decode a blank image (should return null, but not error)
try {
const result = jsQR(testData, qrWidth, qrHeight);
console.log("jsQR test result:", result);
console.log("jsQR is working correctly");
return true;
} catch (error) {
console.error("jsQR test failed:", error);
alert("QR scanner is not working properly. Error: " + error.message);
return false;
}
}
// Call this at page load
window.addEventListener('load', () => {
// Wait a moment to ensure jsQR has time to load
setTimeout(() => {
if (typeof jsQR === 'undefined') {
console.error("jsQR library not loaded after 2 seconds");
alert("QR scanning library failed to load. Please check your internet connection and refresh the page.");
} else {
testJsQrLibrary();
}
}, 2000);
});
// Enhanced camera setup with multiple configuration attempts
async function setupCameraWithOptions() {
const cameraOptions = [
// Option 1: HD resolution
{ 
video: { 
facingMode: "environment",
width: { ideal: 1280 },
height: { ideal: 720 }
}
},
// Option 2: Lower resolution
{ 
video: { 
facingMode: "environment",
width: { ideal: 640 },
height: { ideal: 480 }
}
},
// Option 3: Basic
{ 
video: { 
facingMode: "environment" 
}
},
// Option 4: Front camera as fallback
{ 
video: { 
facingMode: "user" 
}
}
];
const statusEl = document.createElement('div');
statusEl.style.position = 'absolute';
statusEl.style.bottom = '50px';
statusEl.style.left = '10px';
statusEl.style.backgroundColor = 'rgba(0,0,0,0.7)';
statusEl.style.color = 'white';
statusEl.style.padding = '5px';
statusEl.style.zIndex = '999';
document.querySelector('.scanner-container').appendChild(statusEl);
// Try each option until one works
for (let i = 0; i < cameraOptions.length; i++) {
try {
statusEl.textContent = `Trying camera configuration ${i+1}...`;
console.log(`Trying camera configuration ${i+1}:`, cameraOptions[i]);
const stream = await navigator.mediaDevices.getUserMedia(cameraOptions[i]);
// Stop previous stream if exists
if (videoStream) {
videoStream.getTracks().forEach(track => track.stop());
}
// Set the new stream
videoStream = stream;
video.srcObject = stream;
video.setAttribute('playsinline', true);
// Wait for video to be ready
await new Promise((resolve) => {
video.onloadedmetadata = () => {
console.log(`Video dimensions: ${video.videoWidth}x${video.videoHeight}`);
resolve();
};
});
// Try to set focus mode if available
const videoTrack = stream.getVideoTracks()[0];
if (videoTrack) {
try {
const capabilities = videoTrack.getCapabilities();
if (capabilities.focusMode && capabilities.focusMode.includes('continuous')) {
await videoTrack.applyConstraints({
advanced: [{ focusMode: 'continuous' }]
});
console.log("Set continuous focus mode");
}
} catch (e) {
console.log("Could not set focus mode:", e);
}
}
// Success!
statusEl.textContent = `Using camera configuration ${i+1}`;
video.play();
return true;
} catch (error) {
console.error(`Camera configuration ${i+1} failed:`, error);
}
}
// If we get here, all configurations failed
statusEl.textContent = 'Failed to set up camera with any configuration';
alert('Could not initialize camera with any available configuration. Please check camera permissions and try again.');
return false;
}
// Helper function to escape HTML to prevent XSS
function escapeHtml(text) {
if (!text) return '';
return text
.toString()
.replace(/&/g, "&amp;")
.replace(/</g, "&lt;")
.replace(/>/g, "&gt;")
.replace(/"/g, "&quot;")
.replace(/'/g, "&#039;");
}
// Initialize current event handlers
startSessionBtn.addEventListener('click', startSessionBtnHandler);
// When window loads, check if we need to request permissions
window.addEventListener('load', () => {
// We request camera permission only when the user starts a session
// instead of on page load for better user experience
// Create folder in storage for downloads (this is not fully supported in browsers)
// Modern browsers don't allow creating directories or choosing save locations
// for security reasons, but files will be saved according to browser's download settings
});
document.addEventListener('DOMContentLoaded', () => {
  loadJsQRLibrary()
    .then(source => {
      console.log(`jsQR library loaded from ${source}`);
    })
    .catch(error => {
      alert("Failed to load QR scanning library. Error: " + error.message);
    });
});
</script>
</body>
</html>
